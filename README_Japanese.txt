マッピングからcircos風描画までの計算手続き

この手続は小田原・中村・大島・関根による論文
"Ultra-deep sequencing reveals dramatic alteration of organellar genomes in 
Pyscomitrella patens due to biased asymmetric recombination"

で用いた計算に必要なすべてのプログラムを含む。

論文中で使われているファイル名のサフィックス、.mhr および .mhmr　については、実際のプログラムおよび
ここでの記述ではそれぞれ .hr および .hmr と最初のmを外して用いる。
comp_mhr, comp_mhmr 等のプログラム名についても同様に comp_hr, comp_hmr 等とする

多くのプログラムを含み記述も長いが、
組み換え解析に必要なマッピング、描画までの手続きはセクション0.から3.2まで

以下、%で始まる行は、コマンドラインのプロンプトで
/DBdir/ は参照配列等のデータの入っているディレクトリ名で置き換える

---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------

0. マッピングの準備

マッピングには単純なインデックス法によるimmapを用いる

---------------------------------------------------------------------------------------------

0.0 インデックスの作成(mkindex)

mappingに用いるそれぞれのシングルfastaファイル(foo.fasta)についてインデックス長を14とすると

% mkindex  -14  foo.fasta

としてインデックスファイル(foo.fasta.indx14)を作成しておく。
インデックスファイルはファスタファイルと同じディレクトリに置いておく
インデックス長はゲノムサイズにより10~15程度を推奨。

---------------------------------------------------------------------------------------------

0.1 レファレンスリストの作成

マッピングに用いる参照配列のfastaファイル名をref.listというファイルに列挙しておく。
ref.listは１行目が#から始まるタイトル行、
２行目以降が0に続いてtab区切りでfastaファイル名、 gb(genbank)ファイル名となっている。 
fastaファイルはシングルファスタでマルチファスタは現状許容していない、
gbは省略可能。

======================== ref.list ==========================
#Title line
0       /DBdir/CH_MOD.fasta                 /DBdir/CH_MOD.gb
0       /DBdir/MT_MOD.fasta                 /DBdir/MT_MOD.gb
0       /DBdir/Ppatens_318_v3.fa.out.fasta
============================================================

このコケの例では、１つめと２つめのファイルが注目する葉緑体とミトコンドリアのゲノムであり
３つ目のファイルは細胞核の染色体の配列である。
３つ目のファイルは複数の染色体配列からなるが、ここでは全配列を500個のNで繋げた
シングルファスタファイルとしている。
３つのファイルそれぞれについて、0.0の手続きによりインデックスファイルを準備しておく

---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------

1. マッピング(immap, chopfastq)

---------------------------------------------------------------------------------------------

1.1 ミスマッチを多く許容するマッピング（ジャンクションリードの検出）

% immap  -a 16 -i 14 -h 75 -r 10 -job i14h75r10 ref.list PpWT.fastq

のようにしてimmapを実行する
入力ファイルはリードデータ(fastqファイル、最後のアーギュメント、
ペアエンドデータの場合は、R1,R2の順でマージして一つのファイルにして置く）
と参照配列ファイル名のリスト(ref.list 最後から２番目のアーギュメント）
リードファイルのペアエンドについてはR1-R2の順序で一つのfastqにマージしておく

-で始まるオプションについては以下の通り

-a #: 並列計算のスレッド数
-i #: インデックス長(例では14塩基）
-h #: １リードあたり許容するミスマッチ数
     （ジャンクションリード解析の場合リード長の半分弱程度、例では10回）
-r #: インデックス位置をシフトして探索する回数。可能ならh+1、-hを多く撮る場合は10~20程度。
-job ~: 出力ファイルに付くジョブ名の文字列、

マッピング結果は .hit というテキストファイルにそれぞれのリードのマップ位置として出力される。
midhr、ispmapを含む以降の解析ではこのファイルを入力として読み込む。 
この時、出力ファイル名に付加される先ほどのref.listの１番目のレファレンスにマップされた結果は
ファイル名に _0 のついた出力hitファイルに、2番目のレファレンスにマップされた結果はファイル名に
 _1 とついた出力hitファイルに記述される。 （ファイルの順序 -1）
現在（ref.list）の例では CH（葉緑体）にマップされた結果が　PpWT.fastq_i14h75r10_0.hit、
MT（ミトコンドリア） にマップされた結果が PpWT.fastq_i14h75r10_1.hit に出力される。

また、-mapというオプション（引数なし）を付けておくと、テキストファイルのマッピング結果を記した
ファイル.mapが作成される。-mw # というオプションで.mapファイルの１行の幅（文字数）を指定できる
（デフォルト300、画面が狭ければ -mw 100)などと狭くする。

---------------------------------------------------------------------------------------------

1.2 短縮したリードのマッピング（デプス解析とペアエンド解析）

ジャンクションリードによる組み換えリンク解析の為にミスマッチ数を多く許容したマッピングを行う他
マッピングデプス解析と、ペアエンドデータによる組み換えリンク解析のために、
リード長を50塩基に短縮したリードファイルを準備する。

% chopfastq -l 50 PpWT.fastq   

出力される短縮リードファイルchp50_PpWT.fastqを、
リードあたりミスマッチ数２個を上限としてマッピングする。

% immap -a 16 -i 14 -h 2 -r 3 -job i14h2r3 ref.list chp50_PpWT.fastq

オプションの記述は先ほどと同様。

---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------
 
2. マッピング結果（デプス）の描画 (ispmap)、および、circos風描画に必要なpebファイルの準備

---------------------------------------------------------------------------------------------

2.1 デプスプロット（ヒストグラム）と後のcircmapsで用いる.pebファイルの作成

ポストスクリプトファイルへのマッピング結果の描画と、
のちにcircos風のプロットでのデプスをプロットする時と
WTのデプスに対する補正を加えたプロットの描画に用いる
時に必要なpeb ファイルを作成するために、 ispmapを実行する。

% ispmap -peb 1 -hd 50 -ds 0.02 -job i14h2r3_0 /DBdir/CH_MOD.fasta chp50_PpWT.fastq  

上記実行例では最後のアーギュメントはリードfastqファイル名、
最後から２番目には参照配列のfastaファイル名を直接記す。
先にも説明した通り、参照配列がref.listで列挙したファイル名の、
何番目のfastaファイルであるか、 によってその前の-job の後に記すジョブ名の_#に記す数値が変わる。 
ここでは一つ目のfastaファイルのCH_MOD.fastaを参照配列とするためジョブ名のサフィックスが
_0となっている。
２番目のMT_MOD.fastaの場合には_1 とする。
参照配列の数だけ、ispmapを実行することになる。
それ以外のオプションとしては、-peb 1として、cirucos風プロット上にマップポピュレーションを
プロットするための1塩基ごとのポピュレーションを示す.pebファイルを出力する。

-hd 50 でプロットの横軸のウィンドウサイズを50bpとする。
-ds 0.02で、 プロットの縦軸のスケールファクター(0.02=50分の１）を指定している。
この二つの値(-hd, -ds)はcircos風描画のデプスプロットには影響しない.
ispmapで出力されるポストスクリプトファイル上のものであり、描画を行いながら適切な値を設定する。

---------------------------------------------------------------------------------------------

2.2 デプスプロット（ヒストグラム）と後のcircmapsで用いる.pebファイルの作成

ispmapからのポストスクリプトファイル出力としては、-bw 1とすることで、
1 pixel １塩基でミスマッチ位置を赤く表示する以下様な実行形態もある。
ゲノムサイズが大きい場合やデプスが極めて深い場合には、
出力ファイルサイズが大きくなりうるので注意して実行する。

% ispmap -bw 1 -cc -map -job i14h75r10_0 /DBdir/CH_MOD.fasta PpWT.fastq  

-cc は色指定のためのオプション、-mapはimmapでテキスト表示のmapを作り忘れた場合に、
ispmapで指定することでimmapによるマッピングを実行し直さなくても出力できる。

---------------------------------------------------------------------------------------------

3. リンク情報の抽出（midhr）からcircos風マップの描画　
   ペアエンド(3.1)とジャンクションリード(3.2)
   (midhr, circmaps, idss, exclude_id_pairs, sort_pdist)

---------------------------------------------------------------------------------------------

3.1.0 ペアエンドリードからの組み換え推定

% midhr -ptd 1000 -job i14h3r4_0 /DBdir/CH_MOD.fasta chp50_PpWT.fastq 
% midhr -ptd 1000 -job i14h3r4_1 /DBdir/MT_MOD.fasta chp50_PpWT.fastq 

最後の２つのアーギュメントが参照配列とリードファイルの名前
ジョブ名の最後の_0はここでは葉緑体に対応する
短く切ったペアエンンドリード(chp50_###.fastq)のマップ結果から、
ペアリードが-ptdオプションで指定した距離よりも離れているリードペアのリードidと
マップ位置のリストが.pdistというファイルに出力される。
-ptd オプションはペアリードのマップ位置が、
指定した数値以上離れている場合と向きが揃っている場合に、
異常な（組み換えに由来する）ペアとして.pdistファイル等に出力する。
例では1000塩基以上離れている場合、と向かい合っていない場合に（ペアリード間に組み換えの存在する）
ものであると判断する。
pdistファイルは、pdist, pdist2, pdist3, pdist4 の４種類があり、それぞれ、

pdist:   一定値(1000)塩基以上離れたペア（異常なペア、向きによらない）
pdist2: 一定値(1000)塩基内で向かい合っているペアのリスト（正常なペア）
pdist3: 一定値(1000)塩基以内で向きがおなじペアのリスト（異常なペア）
pdist4: 一定値(1000)塩基以内で向きが同じ、あるいは一定値(1000)塩基以上離れたペア（pdist+pdist3)

---------------------------------------------------------------------------------------------

3.1.1 参照配列中の長い（50bp以上）リピートの検出

得られたpdistファイルについて、ゲノム配列中に長い（50塩基以上）相同配列が存在することによる
組み換えのアーティファクトが観測されることがある。
この問題を低減させるために、まず、ゲノム配列に含まれる長い（50塩基以上）相同配列を
idss(IDentical Sequence Search)によりリストアップした.idsファイルを作成しておく。

% idss  -i 8 -m 50 CH_MOD.fasta > CHi8m50.ids 
% idss  -i 8 -m 50 MT_MOD.fasta > CHi8m50.ids 

-m オプションで指定する長さ以上の繰り返し配列が抽出される。
-iオプションで指定する数値は探索に用いる任意のインデックス長（4~14程度で -mの値より小さくする）
idssは標準出力に結果を出すのでリダイレクトにより任意のファイル名（ここではCHi8m50.ids)を指定する

---------------------------------------------------------------------------------------------

3.1.2 参照配列中のリピートによる組み換えアーティファクトの除去

得られた .ids ファイルを用いて、pdistからアーティファクトと考えられる組み換えを示唆するペアを
exclude_id_pairsを用いて除去する

% exclude_id_pairs chp50_PpWT_0.pdist CHi8m50.ids > chp50_PpWT_0.excl.pdist
% exclude_id_pairs chp50_PpWT_1.pdist MTi8m50.ids > chp50_PpWT_1.excl.pdist

exclude_id_pairsでも標準出力への結果をリダイレクトにより任意のファイル名のpdistファイルに出力する

pdistファイルは個々のペアリードのマップ位置が記されているので、
ここから近いマップ位置を共有するリードペアをクラスタリングするために sort_pdist を実行する

% sort_pdist  chp50_PpWT_0.excl.pdist
% sort_pdist  chp50_PpWT_1.excl.pdist

---------------------------------------------------------------------------------------------

3.1.3 ペアエンド情報によるCircos風リンク描画

これにより同じ相同組み換えを示唆すると考えられるリードペアを一つのグループにまとめた
.pe 出力ファイルが得られる（chp50_PpWT_0.excl.pdist.pe）。
このファイルと2.で得られたマッピングデプス情報を含む .peb ファイルを入力ファイルとして、
組み換えによるリンク、デプス、などを可視化するcircos風の描画を行う。

% circmaps -rpb chp50_PpWT.fastq_i14h2r3_0.peb \
           -rgb /DBdir/CH_MOD.gb \
           -rfa /DBdir/CH_MOD.fasta \
           -pe \
           -bls 1.0 \
           -psc 2 \
           -drm 5 \
           chp50_PpWT.fastq_i14h2r3_0.excl.pdist.pe

% circmaps -rpb chp50_PpWT.fastq_i14h2r3_1.peb \
           -rgb /DBdir/MT_MOD.gb \
           -rfa /DBdir/MT_MOD.fasta \
           -pe \
           -bls 1.0 \
           -psc 2 \
           -drm 5 \
           chp50_PpWT.fastq_i14h2r3_1.excl.pdist.pe

多くのオプションがあるため、1行のコマンドを複数行に分け行末の \ （backslash）でつないでいる。
最後の行を先に作成した .pe ファイルのコマンドアーギュメントとする。
各オプションとその引数については以下の通り

-rpb: .pebファイル名 2で作成した、リードデプスを記述したファイル
-rgb: .gbファイル名　GenBank　circos風マップの外側のトラックに遺伝子位置を表示する
-rfa: .fastaファイル名、ゲノム配列のファスタファイル
-pe:   ペアエンドによる.peファイルを読み込んでのリンク描画を指定
      （後述するジャンクションリードによる描画ではこのオプションを外す）
-bls:  リンクによるデプス増減を示すプロット（デプスの一つ内側のトラック）
       のスケール（デフォルト1.0) 
-psc:  デプス(pebによるプロット）のスケールファクター
-drm:  描画方法のトラック指定等のためのオプション　
       現時点では.peのプロットの場合には５のみ

---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------

3.2. ジャンクションリードからの組み換え推定 (midhr, circmaps)

---------------------------------------------------------------------------------------------

3.2.1 ジャンクリョンリードの検出、ジャンクションリードクラスタの形成と組み換え予測

1.0 での短縮しないリードのミスマッチを多く許したマッピングにより得られたヒット位置のファイル
.hitと、参照配列（.fasta）、リード配列（.fastq）を入力として、 midhrにより、
ジャンクションリードとそれらにより推定される組み換え位置を検出する。

% midhr -cl 13  -cd 3 -job i14h75r10_0 /DBdir/CH_MOD.fasta PpWT.fastq   

オプションはそれぞれ
-cl #: ミスマッチコンセンサス配列の長さの下限
-cd #: ミスマッチコンセンサス配列を構成するのに必要な最小リード数
-job $$: immapによるマッピングで用いたジョブ名　+  参照配列の番号（振り方は1,2を参照）

参照配列とリード配列を最後の２つのアーギュメントとし、.hitファイルは、.fastqファイル名
とジョブ名から自動的に生成される。
ジャンクションリードの検出とジャンクションクラスタの形成はやや複雑なので、
論文による記述を参照し、不明な点についてはお問い合わせください。

以下に得られる出力ファイルのうち今回の解析に関連するものについてサフィックスごとに記述する。

.del	50塩基以内の単純なデリーション（欠失）
.ins	50塩基以内の単純なインサーション（挿入）
.hr	相同組み換え（２塩基以上のマイクロホモロジーがある）
.hmr	相同組み換え（双方向の組み換えを示すリードを含む）
.pal	パリンドローム配列による70塩基以内での逆向きの組み換え（不完全なパリンドロームを含む）
.unk	組み換え：相同性が認められない場合
.arr	.hr, .unk, .del, .ins の４出力を合わせた出力
 
以下、.jで始まる出力はジャンクションクラスタの状態を記述したファイル
.jcr	ジャンクションリード情報 個々のジャンクションリードと参照配列とのミスマッチ部位を示す
.jcc	ジャンクションクラスタ情報 ミスマッチコンセンサスを形成する全てのミスマッチ配列を含む
.jcs	各ジャンクションクラスタのミスマッチ開始点と、ミスマッチ配列のヒット位置のみを表示

---------------------------------------------------------------------------------------------


3.2.2 Circos風マップの描画　ジャンクションリード解析

ジャンクションリードのクラスタが示唆する全ての組み換え(.del,.ins,.hr,.unk)を可視化した
circos風描画のpsファイルを作成する。
入力ファイルの.gbファイルは遺伝子位置情報、
.pebファイルはリードポピュレーションに関する情報を含む

解析結果について、ペアエンドの時と同様にcirucos風描画での可視化を行うには、circmapsで
-peオプションを外し、-drm を 6として、最後のアーギュメントに.arr, .hr, .unk等のファイルを指定

% circmaps -rpb chp50_PpWT.fastq_i14h2r3_0.peb \
           -rgb /DBdir/CH_MOD.gb \
           -rfa /DBdir/CH_MOD.fasta \
           -bls 1.0 \
           -psc 2 \
           -drm 6 \
           PpWT.fastq_i14h75r10_0.arr

これによりポストスクリプトファイルが生成される。  PpWT.fastq_i14h75r10_0.arr.ps

---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------

4. 実験（変異体）間の変異（リンク）出力の比較 （note 9/10)
   (comp_del, comp_ins, comp_hr, comp_hmr, comp_pal, comp_unk, comp_pe)

野生株と変異株あるいは変異株間で、共通する組み換え（変異）もあれば、
特定の株でしか生じない組み換えもある。
複数の株のデータを比較して共通する組み換えを表にまとめる作業を行うために、
前節3.2で得られるmidhrからの出力ファイル.del, .ins, .hr, .hmr, .pal, .unk, .pe について
それぞれcomp_del, comp_ins, comp_hr, comp_hmr, comp_pal, comp_unk, comp_pe の
６つの簡単なプログラムを準備した。
使い方としてはたとえばcomp_delでは、それぞれの株に由来するリードデータをマッピングした
.hitからmidhrにより得られる .del ファイルのリストを作成する。

========================== del.list =============================
PpWT.fq_i11h35r36immap_0.del   40223458
Mut1.fq_i11h35r36immap_0.del   37033756
Mut2.fq_i11h35r36immap_0.del   42008745
=================================================================

リストは２カラムで、左側にファイル名（絶対パス）空白区切で右側に、株間の補正を行うための整数値、
例えば、総リード数、対応する参照配列マップされたリード数、等を記す。
１行目を野生株（標準）とする。作成したmutants_del.listファイルについて、

% comp_del del.list

と実行することで、.outと.out2のサフィックスを加えた二つのファイルが作成される。

出力は、ins,del,pal,hmrについては各行がコンマで区切られたcvsファイルであり、

左側のカラムについては、
delでは最初の２カラムが、塩基位置、欠失塩基数
insでは最初の３カラムが、塩基位置、挿入塩基数、挿入塩基配列
palでは最初の３カラムが、（擬似）パリンドローム配列の前後の塩基位置と配列
hmrでは最初の５カラムが、相同配列の開始・終止位置２組（４カラム）と相同配列
残りの右側のカラムについては、各株でその変異を示すジャンクションリード数（.out）および、
入力ファイルに記した総リード数等で補正（一つ目のエントリを標準(1.0)とした比率をかける）
した出力（.out2）である。

また、hr,unk,peについては横方向の位置を揃えた空白区切りの出力ファイルとなっており、
unkでは、左側の２つのカラムが、組み換えの塩基位置で、
.hrでは、左側の２つのカラムが、組み換えの塩基位置、右端のカラムが相同配列
.peでは、左側の２つのカラムが、組み換えを示唆するクラスタのシード配列のマップ位置であり、
３カラム目からの株数カラムにジャンクションクラスタに含まれるリード数（.out）、
および総リード数等で補正したリード数（.out2）

---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------

5. デプスプロット（対WTで補正）(note:7/26)
   (pop_comp)

ispmap (2.1) で得られるpebファイルにはそれぞれの株のリードの参照配列上の各塩基位置に
マップされたリード数が記されている。
この情報をもとに、野生株を1.0とした場合の変異株のデプスの分布をプロットすることができる。
さらに、変異によってマップされるリード数が影響を受けない特定の参照配列領域に張り付いた
リード数で、変異によるリード数変化を補正することができる。
このために、野生株についての.pebファイル、変異株についての.pebファイルと、
補正のためのスケールファクター（実数値）を入力する。

% pop_comp -sf 0.588 WT.fastq_i14h2r3_0.peb MUT1.fastq_i14h2r3_0.peb
% pop_comp -sf 0.588 WT.fastq_i14h2r3_1.peb MUT1.fastq_i14h2r3_1.peb

-sfの後にスケールファクター、（我々の実験ではオルガネラへのマップ量を、
核の染色体へのマップ量を基準として補正するために、
野生株の核の染色体にマップされたリード数、を、変異株の核の染色体にマップされた
リード数で割った値、をスケールファクターとした）ついで、
野生株のpebファイル名、変異株のpebファイル名をスペースで区切って続ける。
上記手続きによりMUT1.fastq_i14h2r3_0.peb.psというポストスクリプトファイルが生成される。

---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------
 
6. 参照配列中一定の長さ以上のリピート数をゲノム配列部位ごとにカウントしてプロット 
   (reptile)

一定長さ以上のリピート数をゲノム配列部位ごとにカウントしてプロットするプログラム

-ph ヒット位置とマッチの長さを表示
-ps マッチした配列（sequence)を表示
-idx ## サーチに使うインデックス長を表示
-min ## この長さ以上のリピートをサーチ
-max ## この長さ以下のリピートをサーチ

出力ファイル（現状・常時出る）
foo.pos  pos_list  距離範囲内のリピートマッチが見つかった時 それぞれの位置を表示（１行１箇所）
foo.dst  dist_file  距離範囲内のリピートマッチが見つかった時　始点と終点の距離を印字
foo.hmp  hm_file  ヒートマップ長さの組み合わせ リンクの始点と終点
標準出力 -ph ヒットしたリピートの位置（組み）と長さ
         -ps ヒットした配列

たとえばインデックス10 最短11 最長100でMT.fastaについて実行

% reptile -ph -ps -idx 10 -min 11 -max 100 MT.fasta > MT_10_11_100.out

標準出力の他に、MT.fasta.pos, MT.fasta.dst, MT.fasta.hmp ができる
このうち.posを使う。-min と -max を変えながら実行する際に同じファイル名を上書きしてしまうので
mv MT.fasta.pos MT_10_11_100.out 
の様に実行条件をつけたファイル名に変更しておく

Rを立ち上げて、科学ライブラリをロード
> library(MASS)
.posファイルをロード
>MT_10_11_100=scan("/Users/~~~/MT_10_11_100.pos")
出力ps ファイル名を指定
> postscript ("MT_10_11_100.ps")
ヒストグラム描画
> truehist(MT_10_11_100,prob=FALSE,nbins=50)
ポストスクリプト書き込み
> dev.off()
ホームディレクトリに.psができる

---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------

7. midhr出力(.hr)から、相同配列の長さ区分（3-5, 6-10, 11以上）毎に組み換え位置を出力
　(hr_count)

リードマッピングの結果得られるmidhrのジャンクションリード解析結果による、
相同組み換えの組み合わせの位置出力.hrを読み込んで
特定の長さの相同配列の組み合わせについてのみ始点と終点の位置を出力する

% hr_count  foo.hr

で、foo.hr.3_5.pos、foo.hr.6_10.pos、foo.hr.10_100.pos(実際には11以上）
三つのファイルに、それぞれの相同配列長の範囲3~5, 6~10, 11~100の位置の入ったファイルができる
hr_count MSD202-1.fastq_i14h75r10_0.hr
とすれば
MSD202-1.fastq_i14h75r10_0.hr.3_5.posなど三つのファイルができる

Rを立ち上げて
>CH_J_RECG_3_5=scan("/Volumes/TOWER/~~~ /MSD202-1.fastq_i14h75r10_0.hr.3_5.pos")
> postscript("CH_J_RECG_3_5.ps")
> truehist(CH_J_RECG_3_5,nbins=50,prob=FALSE,xlim=c(0,130000))
> dev.off()

truehistのnbinsは大体の縦棒の数、xlimは横方向の描画範囲、prob=FALSEで縦軸を頻度（カウント数）
にできる（付けないと全体を１とした場合の比率みたいな数字でわかりにくい）

---------------------------------------------------------------------------------------------

8. midhr出力(.hr)から、.hmrを再整理し、 リンク位置を記載したファイル .psd および、 リード数をリンク位置に示す
　　ファイル .psd2 を出力する
(h2h)

midhrで出力される.hmrファイルは、見出されたジャンクションの相同配列について、対応するジャンクションリードを探し
直す手続きを含むため、ジャンクションクラスタのクライテリアを満たさない部位も見える場合がある。
これとは別に、クライテリアを満たすジャンクションクラスタだけで構成される.hrから、同様の対応する相同配列に関与する
ジャンクションクラスタを再整理した出力を .hr ファイルを入力として作成するためにプログラム h2h を用いる

% h2h PpWT.fastq_i14h75r10_1.hr 

の様に実行することで、ファイル名の末尾に .hmr を付加した PpWT.fastq_i14h75r10_1.hr.hmr が出力される
また、各塩基位置について、正方向および逆方向のリンク数を記したファイル PpWT.fastq_i14h75r10_1.hr.psd
（三つのカラム からなる、1. 塩基位置、 2. 正方向のリンク数 3. 逆方向のリンク数）
および、リンク数にそれぞれのリンクを構成するジャンクションリード数を掛けた結果を出力するファイル
PpWT.fastq_i14h75r10_1.hr.psd2
（三つのカラムからなる、1. 塩基位置、 2. 正方向のリンクを構成するジャンクションリード数 3. 逆方向のリンクを
構成するジャンクションリード数

---------------------------------------------------------------------------------------------

9. 8で再構成された .hmr出力 から 一定幅のウィンドウ内でのリンク数(.psd)のヒストグラムを出力する
(h2h_histo)

まず、前節（8.）で再構成された .psd ファイルそれぞれの各行を塩基番号順にソートする

% sort -k 1 -n PpWT.fastq_i14h75r10_1.hr.psd  > PpWT_MT.psd

それぞれについて、ウィンドウのサイズと参照配列の長さ（それぞれ塩基長）をアーギュメントとして加えて
ヒストグラムファイル(.hst)を得る 以下の例ではウィンドウサイズ 1000 参照配列長 105340として
それぞれ第二・第三アーギュメントとして実行

% h2h_histo  1000 105340 PpWT_MT.psd  > PpWT_MT.hst


---------------------------------------------------------------------------------------------

10. 9で再構成された .hmr出力 から 一定幅のウィンドウによる全体の分布について、森下インデックスを計算する
(h2h_morisita)

% h2h_morisita  1000 105340 PpWT_MT.psd  

id1 と id2 の２つの数字が標準出力に表示される
id1 が上流へのリンク、id2が下流へのリンクの分布に関する森下インデックスである
